---

# Install Atom from Homebrew Cask if necessary
- name: Install Atom from Homebrew Cask if necessary
  homebrew_cask: name="atom" state=present

# Make sure Atom and apm are installed, fail if not installed
- name: Ensure Atom and apm (Atom Package Manager) are installed
  command: which atom apm
  register: atom_status
  failed_when: atom_status.rc
  changed_when: false
  check_mode: no

# apm clean: Delete packages in node_modules not in use
- name: apm clean
  command: apm clean
  when: clean

# apm config: set or delete Atom configuration variables
- name: apm config items and preferences
  command: "apm config {{ item.command }}"
  when: 
    - item.enable
    - item.command != "edit"
  with_items:
    - "{{ config }}"

# apm dedupe: Dedupe node_module package
- name: apm dedupe packages
  command: "apm dedupe {{ item.packages | default(omit) }}"
  when:
    - item.enable
  with_items:
    - "{{ dedupe }}"

### {{ (item.verbose == 'true') | ternary('--verbose', omit) }}

# apm install: Install Atom packages
- name: "apm install package: Install Atom packages"
  command: "apm install {{ item.package }} {{ (item.verbose == 'true') | ternary('--verbose', '')
  with_items:
    - "{{ install }}"

# apm install: Install Atom packages file